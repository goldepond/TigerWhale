<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 마이바티스 설정파일 type에 명시된 클래스를 함축이름으로 사용합니다. -->

<mapper namespace="com.tigerWhale.mainBoard.mapper.MainBoardMapper">
	<select id="getPopularPage" resultType="MainBoardVO">
		select ma.*
		from mainBoard ma
		inner join mentorBoard me
		on ma.user_id = me.user_id
		order by me.sellscore_avg desc
	</select>
	
	<select id="getBestBoard" resultType="MainBoardVO">
		select ma.* 
	    from V_R_Board vr
	    inner join mainBoard ma
	    on vr.bno = ma.bno
	    order by viewNum desc ,recomendNum desc
	</select>
	
	<select id="getRecentBoard" resultType="MainBoardVO">
		select * from mainBoard order by M_registDate desc
	</select>
	
	<select id="getNearBoard" resultType="MainBoardVO">
		SELECT *
		FROM (
		SELECT ( 6371 
		            * acos(
		                        cos( radians(127.030713517605 ) ) --유저 la
		                        * cos( radians(LA) ) --조회테이블 칼럼 ma
		                        * cos( radians( 37.6099298570224 ) - radians(MA) ) --유저 ma  -조회테이블ma
		                        +
		                        sin( radians(127.030713517605) ) --유저la
		                        * sin( radians(LA) ) -- 조회테이블 ma
		                     ) 
		        ) AS distance , lo.*
		FROM locationBoard lo
		) lob
		INNER JOIN mainBoard ma
		on ma.user_id = lob.user_id<![CDATA[
		WHERE distance < 3 and distance != 0 	]]>	
	</select>
</mapper>